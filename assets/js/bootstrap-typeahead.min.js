/**
* Bootstrap.js by @mdo and @fat, extended by @ArnoldDaniels.
* plugins: bootstrap-typeahead.js
* Copyright 2012 Twitter, Inc.
* http://www.apache.org/licenses/LICENSE-2.0.txt
*/
!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.typeahead.defaults,c),this.options.target&&(this.$target=a(this.options.target)),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.strict=this.options.strict,this.$menu=a(this.options.menu),this.shown=!1,typeof this.source=="string"&&(this.url=this.source,this.source=this.searchAjax),b.nodeName=="SELECT"&&this.replaceSelect(),this.text=this.$element.val(),this.$element.attr("data-text",this.value).attr("autocomplete","off"),typeof this.$target!="undefined"?this.$element.attr("data-value",this.$target.val()):typeof this.$element.attr("data-value")=="undefined"&&this.$element.attr("data-value",this.strict?"":this.value),this.$menu.css("min-width",this.$element.width()+12),this.listen()};b.prototype={constructor:b,replaceSelect:function(){this.$target=this.$element,this.$element=a('<input type="text" />'),this.source={},this.strict=!0;var b=this.$target.find("option"),c;for(var d=0;d<b.length;d++){c=a(b[d]);if(c.val()===""){this.$element.attr("placeholder",c.html());continue}this.source[c.val()]=c.html(),this.$target.val()==c.val()&&this.$element.val(c.html())}var e=this.$target[0].attributes;for(d=0;d<e.length;d++)e[d].nodeName!="type"&&e[d].nodeName!="name"&&e[d].nodeName!="id"&&e[d].nodeName!="data-provide"&&!e[d].nodeName.match(/^on/)&&this.$element.attr(e[d].nodeName,e[d].nodeValue);this.$element.insertAfter(this.$target),this.$target.attr("autofocus")&&this.$element.trigger("focus").select(),this.$target.attr("autofocus",!1),this.$target.hide()},destroyReplacement:function(){typeof this.$target!="undefined"&&this.$target[0].nodeName=="SELECT"&&this.$element.replaceWith("")},select:function(){var a=this.$menu.find(".active"),b=a.attr("data-value"),c=a.find(".item-text").length>0?a.find(".item-text").text():a.text();return b=this.updater(b,"value"),c=this.updater(c,"text"),this.$element.val(c).attr("data-value",b),this.text=c,typeof this.$target!="undefined"&&this.$target.val(b).trigger("change"),this.$element.trigger("change"),this.hide()},updater:function(a,b){return a},show:function(){var b=a.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:b.top+b.height,left:b.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(b){var c;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(c=a.isFunction(this.source)?this.source(this.query,a.proxy(this.process,this)):this.source,c?this.process(c):this)},process:function(b){return a.isArray(b)?this.processArray(b):this.processObject(b)},processArray:function(b){var c=this;return b=a.grep(b,function(a){return c.matcher(a)}),b=this.sorter(b),b.length?this.render(b.slice(0,this.options.items)).show():this.shown?this.hide():this},processObject:function(b){var c=this,d={},e=0;return a.each(b,function(a,b){c.matcher(b)&&(d[a]=b)}),d=this.sorter(d),a.isEmptyObject(d)?this.shown?this.hide():this:(a.each(d,function(a,b){e++>=c.options.items&&delete d[a]}),this.render(d).show())},searchAjax:function(b,c){var d=this;this.ajaxTimeout&&clearTimeout(this.ajaxTimeout),this.ajaxTimeout=setTimeout(function(){d.ajaxTimeout&&clearTimeout(d.ajaxTimeout);if(b===""){d.hide();return}a.get(d.url,{q:b,limit:d.options.items},function(a){typeof a=="string"&&(a=JSON.parse(a)),c(a)})},this.options.ajaxdelay)},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(b){return a.isArray(b)?this.sortArray(b):this.sortObject(b)},sortArray:function(a){var b=[],c=[],d=[],e;while(e=a.shift())e.toLowerCase().indexOf(this.query.toLowerCase())?~e.indexOf(this.query)?c.push(e):d.push(e):b.push(e);return b.concat(c,d)},sortObject:function(a){var b={},c;for(c in a)a[c].toLowerCase().indexOf(this.query.toLowerCase())||(b[c]=a[c],delete a[c]);for(c in a)~a[c].indexOf(this.query)&&(b[c]=a[c],delete a[c]);for(c in a)b[c]=a[c];return b},highlighter:function(a){var b=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+b+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this,d=a([]);return a.map(b,function(e,f){if(d.length>=c.options.items)return;var g,h;a.isArray(b)&&(f=e),g=a(c.options.item),h=g.find("a").length?g.find("a"):g,h.html(c.highlighter(e)),g.attr("data-value",f),g.find("a").length===0&&g.addClass("dropdown-header"),d.push(g[0])}),d.not(".dropdown-header").first().addClass("active"),this.$menu.html(d),this},next:function(b){var c=this.$menu.find(".active").removeClass("active"),d=c.nextAll("li:not(.dropdown-header)").first();d.length||(d=a(this.$menu.find("li:not(.dropdown-header)")[0])),d.addClass("active")},prev:function(a){var b=this.$menu.find(".active").removeClass("active"),c=b.prevAll("li:not(.dropdown-header)").first();c.length||(c=this.$menu.find("li:not(.dropdown-header)").last()),c.addClass("active")},listen:function(){this.$element.on("blur",a.proxy(this.blur,this)).on("change",a.proxy(this.change,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",a.proxy(this.keydown,this)),this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this)),a(window).on("unload",a.proxy(this.destroyReplacement,this))},eventSupported:function(a){var b=a in this.$element;return b||(this.$element.setAttribute(a,"return;"),b=typeof this.$element[a]=="function"),b},move:function(a){if(!this.shown)return;switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),this.prev();break;case 40:a.preventDefault(),this.next()}a.stopPropagation()},keydown:function(b){this.suppressKeyPressRepeat=~a.inArray(b.keyCode,[40,38,9,13,27]),this.move(b)},keypress:function(a){if(this.suppressKeyPressRepeat)return;this.move(a)},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}a.stopPropagation(),a.preventDefault()},change:function(a){var b;this.$element.val()!=this.text&&(b=this.$element.val()===""||this.strict?"":this.$element.val(),this.$element.val(b),this.$element.attr("data-value",b),this.text=b,typeof this.$target!="undefined"&&this.$target.val(b))},blur:function(a){var b=this;setTimeout(function(){b.$menu.is(":hover")||b.hide()},150)},click:function(a){a.stopPropagation(),a.preventDefault(),this.select()},mouseenter:function(b){this.$menu.find(".active").removeClass("active"),a(b.currentTarget).addClass("active")}};var c=a.fn.typeahead;a.fn.typeahead=function(c){return this.each(function(){var d=a(this),e=d.data("typeahead"),f=typeof c=="object"&&c;e||d.data("typeahead",e=new b(this,f)),typeof c=="string"&&e[c]()})},a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',ajaxdelay:400,minLength:1},a.fn.typeahead.Constructor=b,a.fn.typeahead.noConflict=function(){return a.fn.typeahead=c,this},a(document).off("focus.typeahead.data-api").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(b){var c=a(this);if(c.data("typeahead"))return;c.is("select")&&c.attr("autofocus",!0),b.preventDefault(),c.typeahead(c.data())})}(window.jQuery)